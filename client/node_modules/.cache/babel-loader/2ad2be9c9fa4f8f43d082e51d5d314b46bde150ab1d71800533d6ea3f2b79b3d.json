{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import axios from\"../utils/api\";import{DateRangePicker}from\"react-date-range\";import{useNavigate}from\"react-router-dom\";import\"./Collection.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Collection=()=>{const[gowns,setGowns]=useState([]);const[searchQuery,setSearchQuery]=useState(\"\");const[selectedGown,setSelectedGown]=useState(null);const[availabilityModal,setAvailabilityModal]=useState(false);const[selectedDates,setSelectedDates]=useState([{startDate:new Date(),endDate:new Date(),key:\"selection\"}]);const[availabilityMessage,setAvailabilityMessage]=useState(\"\");const navigate=useNavigate();useEffect(()=>{const fetchGowns=async()=>{try{const{data}=await axios.get(\"/gowns\");// Directly destructure the response\nsetGowns(data);}catch(error){console.error(\"Error fetching gowns:\",error);}};fetchGowns();},[]);const handleCheckAvailability=async()=>{if(!selectedGown)return;const{startDate,endDate}=selectedDates[0];try{const{data}=await axios.post(\"/gowns/availability\",{gownId:selectedGown._id,startDate,endDate});setAvailabilityMessage(data.message);}catch(error){var _error$response;console.error(\"Error checking availability:\",error);setAvailabilityMessage(((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data.message)||\"An error occurred while checking availability.\");}};const handleAddToCart=async()=>{const{startDate,endDate}=selectedDates[0];try{if(availabilityMessage===\"Gown available\"){const token=localStorage.getItem(\"token\");// Ensure the token is present\nif(!token){alert(\"You need to log in to add items to your cart.\");navigate(\"/login\");// Redirect to login page if not authenticated\nreturn;}await axios.post(\"/cart/add\",{gownId:selectedGown._id,startDate,endDate,price:selectedGown.price},{headers:{Authorization:`Bearer ${token}`}});alert(\"Gown added to cart!\");navigate(\"/cart\");// Navigate to cart page after adding\n}}catch(error){var _error$response2;console.error(\"Error adding to cart:\",error);alert(((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data.message)||\"An error occurred while adding the gown to the cart.\");}};const filteredGowns=gowns.filter(gown=>gown.name.toLowerCase().includes(searchQuery.toLowerCase()));return/*#__PURE__*/_jsxs(\"div\",{className:\"collection\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Our Collection\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Search gowns...\",value:searchQuery,onChange:e=>setSearchQuery(e.target.value),className:\"search-bar\"}),/*#__PURE__*/_jsx(\"div\",{className:\"gown-list\",children:filteredGowns.length>0?filteredGowns.map(gown=>/*#__PURE__*/_jsxs(\"div\",{className:\"gown-card\",children:[/*#__PURE__*/_jsx(\"img\",{src:gown.image,alt:gown.name,className:\"gown-image\"}),/*#__PURE__*/_jsx(\"h2\",{children:gown.name}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Category: \",gown.category]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Price: \\u20B1\",gown.price]}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setSelectedGown(gown);setAvailabilityModal(true);},children:\"Check Availability\"})]},gown._id)):/*#__PURE__*/_jsx(\"p\",{children:\"No gowns found.\"})}),availabilityModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"availability-modal\",children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Check Availability for \",selectedGown===null||selectedGown===void 0?void 0:selectedGown.name]}),/*#__PURE__*/_jsx(DateRangePicker,{ranges:selectedDates,onChange:item=>setSelectedDates([item.selection]),minDate:new Date()}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCheckAvailability,children:\"Confirm Dates\"}),availabilityMessage&&/*#__PURE__*/_jsx(\"p\",{className:`availability-message ${availabilityMessage===\"Gown available\"?\"success\":\"error\"}`,children:availabilityMessage}),availabilityMessage===\"Gown available\"&&/*#__PURE__*/_jsx(\"button\",{onClick:handleAddToCart,children:\"Add to Cart\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setAvailabilityModal(false),children:\"Close\"})]})})]});};export default Collection;","map":{"version":3,"names":["React","useState","useEffect","axios","DateRangePicker","useNavigate","jsx","_jsx","jsxs","_jsxs","Collection","gowns","setGowns","searchQuery","setSearchQuery","selectedGown","setSelectedGown","availabilityModal","setAvailabilityModal","selectedDates","setSelectedDates","startDate","Date","endDate","key","availabilityMessage","setAvailabilityMessage","navigate","fetchGowns","data","get","error","console","handleCheckAvailability","post","gownId","_id","message","_error$response","response","handleAddToCart","token","localStorage","getItem","alert","price","headers","Authorization","_error$response2","filteredGowns","filter","gown","name","toLowerCase","includes","className","children","type","placeholder","value","onChange","e","target","length","map","src","image","alt","category","onClick","ranges","item","selection","minDate"],"sources":["C:/Users/ecaranto/Downloads/gown-booking-system with admin/client/src/pages/Collection.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport axios from \"../utils/api\";\r\nimport { DateRangePicker } from \"react-date-range\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport \"./Collection.css\";\r\n\r\nconst Collection = () => {\r\n  const [gowns, setGowns] = useState([]);\r\n  const [searchQuery, setSearchQuery] = useState(\"\");\r\n  const [selectedGown, setSelectedGown] = useState(null);\r\n  const [availabilityModal, setAvailabilityModal] = useState(false);\r\n  const [selectedDates, setSelectedDates] = useState([\r\n    {\r\n      startDate: new Date(),\r\n      endDate: new Date(),\r\n      key: \"selection\",\r\n    },\r\n  ]);\r\n  const [availabilityMessage, setAvailabilityMessage] = useState(\"\");\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const fetchGowns = async () => {\r\n      try {\r\n        const { data } = await axios.get(\"/gowns\"); // Directly destructure the response\r\n        setGowns(data);\r\n      } catch (error) {\r\n        console.error(\"Error fetching gowns:\", error);\r\n      }\r\n    };\r\n    fetchGowns();\r\n  }, []);\r\n\r\n  const handleCheckAvailability = async () => {\r\n    if (!selectedGown) return;\r\n\r\n    const { startDate, endDate } = selectedDates[0];\r\n    try {\r\n      const { data } = await axios.post(\"/gowns/availability\", {\r\n        gownId: selectedGown._id,\r\n        startDate,\r\n        endDate,\r\n      });\r\n\r\n      setAvailabilityMessage(data.message);\r\n    } catch (error) {\r\n      console.error(\"Error checking availability:\", error);\r\n      setAvailabilityMessage(\r\n        error.response?.data.message || \"An error occurred while checking availability.\"\r\n      );\r\n    }\r\n  };\r\n\r\n  const handleAddToCart = async () => {\r\n    const { startDate, endDate } = selectedDates[0];\r\n    try {\r\n      if (availabilityMessage === \"Gown available\") {\r\n        const token = localStorage.getItem(\"token\"); // Ensure the token is present\r\n        if (!token) {\r\n          alert(\"You need to log in to add items to your cart.\");\r\n          navigate(\"/login\"); // Redirect to login page if not authenticated\r\n          return;\r\n        }\r\n\r\n        await axios.post(\r\n          \"/cart/add\",\r\n          {\r\n            gownId: selectedGown._id,\r\n            startDate,\r\n            endDate,\r\n            price: selectedGown.price,\r\n          },\r\n          {\r\n            headers: {\r\n              Authorization: `Bearer ${token}`,\r\n            },\r\n          }\r\n        );\r\n\r\n        alert(\"Gown added to cart!\");\r\n        navigate(\"/cart\"); // Navigate to cart page after adding\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error adding to cart:\", error);\r\n      alert(\r\n        error.response?.data.message || \"An error occurred while adding the gown to the cart.\"\r\n      );\r\n    }\r\n  };\r\n\r\n  const filteredGowns = gowns.filter((gown) =>\r\n    gown.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <div className=\"collection\">\r\n      <h1>Our Collection</h1>\r\n      <input\r\n        type=\"text\"\r\n        placeholder=\"Search gowns...\"\r\n        value={searchQuery}\r\n        onChange={(e) => setSearchQuery(e.target.value)}\r\n        className=\"search-bar\"\r\n      />\r\n      <div className=\"gown-list\">\r\n        {filteredGowns.length > 0 ? (\r\n          filteredGowns.map((gown) => (\r\n            <div key={gown._id} className=\"gown-card\">\r\n              <img src={gown.image} alt={gown.name} className=\"gown-image\" />\r\n              <h2>{gown.name}</h2>\r\n              <p>Category: {gown.category}</p>\r\n              <p>Price: â‚±{gown.price}</p>\r\n              <button\r\n                onClick={() => {\r\n                  setSelectedGown(gown);\r\n                  setAvailabilityModal(true);\r\n                }}\r\n              >\r\n                Check Availability\r\n              </button>\r\n            </div>\r\n          ))\r\n        ) : (\r\n          <p>No gowns found.</p>\r\n        )}\r\n      </div>\r\n\r\n      {availabilityModal && (\r\n        <div className=\"modal-overlay\">\r\n          <div className=\"availability-modal\">\r\n            <h2>Check Availability for {selectedGown?.name}</h2>\r\n            <DateRangePicker\r\n              ranges={selectedDates}\r\n              onChange={(item) => setSelectedDates([item.selection])}\r\n              minDate={new Date()}\r\n            />\r\n            <button onClick={handleCheckAvailability}>Confirm Dates</button>\r\n            {availabilityMessage && (\r\n              <p\r\n                className={`availability-message ${\r\n                  availabilityMessage === \"Gown available\" ? \"success\" : \"error\"\r\n                }`}\r\n              >\r\n                {availabilityMessage}\r\n              </p>\r\n            )}\r\n            {availabilityMessage === \"Gown available\" && (\r\n              <button onClick={handleAddToCart}>Add to Cart</button>\r\n            )}\r\n            <button onClick={() => setAvailabilityModal(false)}>Close</button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Collection;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}